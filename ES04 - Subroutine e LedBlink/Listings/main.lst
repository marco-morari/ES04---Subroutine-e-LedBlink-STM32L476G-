


ARM Macro Assembler    Page 1 


    1 00000000         ;=======================================================
                       ===================================
    2 00000000         ; Project:  
    3 00000000         ; Date:     
    4 00000000         ; Author:   
    5 00000000         ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    6 00000000         ;
    7 00000000         ;  <inserire una breve descrizione del progetto>
    8 00000000         ;
    9 00000000         ;  <specifiche del progetto>
   10 00000000         ;  <specifiche del collaudo>
   11 00000000         ;
   12 00000000         ; Ver   Date        Comment
   13 00000000         ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   14 00000000         ; 1.0  01/01/01     Versione iniziale
   15 00000000         ; <Descrivere per ogni revisione o cambio di versione le
                        modifiche apportate>
   16 00000000         ;
   17 00000000         ;=======================================================
                       ===================================
   18 00000000                 THUMB
   19 00000000         
   20 00000000         ;-------------------------------------------------------
                       -----------------------------------
   21 00000000         ;=== COSTANTI ==========================================
                       ===================================
   22 00000000         ;-------------------------------------------------------
                       -----------------------------------
   23 00000000 48000400 
                       GPIOB_MODER
                               EQU              0x48000400
   24 00000000 48000414 
                       GPIOB_ODR
                               EQU              0x48000414
   25 00000000 48001000 
                       GPIOE_MODER
                               EQU              0x48001000
   26 00000000 48001014 
                       GPIOE_ODR
                               EQU              0x48001014
   27 00000000 4002104C 
                       RCC_CR_AHB2
                               EQU              0X4002104C
   28 00000000         
   29 00000000 00000001 
                       PB2_PORT_AHB2_BIT
                               EQU              0x1
   30 00000000 00000005 
                       PB2_MODERH_BIT
                               EQU              0x5
   31 00000000 00000004 
                       PB2_MODERL_BIT
                               EQU              0x4
   32 00000000 00000002 
                       PB2_ODR_BIT
                               EQU              0x2
   33 00000000         



ARM Macro Assembler    Page 2 


   34 00000000 00000004 
                       PE8_PORT_AHB2_BIT
                               EQU              0x4
   35 00000000 00000011 
                       PE8_MODERH_BIT
                               EQU              17
   36 00000000 00000010 
                       PE8_MODERL_BIT
                               EQU              16
   37 00000000 00000008 
                       PE8_ODR_BIT
                               EQU              0x8
   38 00000000         
   39 00000000         ;-------------------------------------------------------
                       -----------------------------------
   40 00000000         ;=== AREA ISTRUZIONI ===================================
                       ===================================
   41 00000000         ;-------------------------------------------------------
                       -----------------------------------
   42 00000000                 AREA             MyCode, CODE, READONLY
   43 00000000                 ALIGN
   44 00000000         ;------------------
   45 00000000         ; EXPORT/IMPORT
   46 00000000         ;------------------
   47 00000000                 EXPORT           __main
   48 00000000                 ENTRY
   49 00000000         
   50 00000000         ;-------------------------------------------------------
                       -----------------------------------
   51 00000000         ;=== MAIN ROUTINE ======================================
                       ===================================
   52 00000000         ;-------------------------------------------------------
                       -----------------------------------
   53 00000000         __main
   54 00000000         ; Inizializzazioni
   55 00000000 F000 F816       BL               LedRossoInit
   56 00000004         ;BL LedVerdeInit
   57 00000004         
   58 00000004         ; Autodiagnostica
   59 00000004         ;BL LedTest
   60 00000004         
   61 00000004         ; Loop infinito
   62 00000004         MainLoop
   63 00000004 F44F 707A       MOV              R0,#1000
   64 00000008 F000 F803       BL               DelayMs
   65 0000000C F000 F820       BL               LedRossoToggle
   66 00000010 E7F8            B                MainLoop
   67 00000012         
   68 00000012         ;------------------
   69 00000012         ;subroutine
   70 00000012         ;------------------    
   71 00000012         ;-------------------------------------------------------
                       ----------------------------------
   72 00000012         ; Esegue R0 volte il ritardo di 1ms. (+1,75us)
   73 00000012         ; A 4Mhz ogni istruzione viene esguita in 250ns = 1/4Mhz
                       
   74 00000012         ; Il ciclo DelayMs_1ms è composto da 5 x nCICLI istruzio
                       ni.
   75 00000012         ; Quindi 5*nCICLI*250ns = 1ms -> nCICLI = 1.000.000/5/25



ARM Macro Assembler    Page 3 


                       0 = 800
   76 00000012         ;  INPUT:  R0 -> Ritardo in millisecondi
   77 00000012         ;  OUTPUT: none
   78 00000012         ;  AUTORE: Filippo Bilardo
   79 00000012         ;  21/03/21  1.0  Versione iniziale
   80 00000012         ;-------------------------------------------------------
                       ---------------------------------- 
   81 00000012         DelayMs
   82 00000012 B506            PUSH             {R1-R2, LR} ;1 
   83 00000014 F44F 7248       MOV              R2,#800     ;2 - nCICLI da eseg
                                                            uire per ogni ms
   84 00000018 FB00 F002       MUL              R0,R0,R2    ;3 - converto i mil
                                                            lisecondi in num ci
                                                            cli
   85 0000001C F04F 0100       MOV              R1,#0x0     ;4 - i=0
   86 00000020         DelayMs_1ms
   87 00000020 4288            CMP              R0,R1       ;n1 - Comparo il va
                                                            lore del registro r
                                                            2 con r1
   88 00000022 D002            BEQ              DelayMs_end ;n2 - Se è uguale s
                                                            alto a end
   89 00000024 F101 0101       ADD              R1,#0x1     ;n3 - Incremento la
                                                             i 
   90 00000028 E7FA            B                DelayMs_1ms ;n4,n5 - Salto a In
                                                            izio (consuma due c
                                                            icli istruzione)
   91 0000002A         DelayMs_end
   92 0000002A E8BD 4006       POP              {R1-R2, LR} ;5
   93 0000002E 4770            BX               LR          ;6,7
   94 00000030         
   95 00000030         
   96 00000030         ;-------------------------------------------------------
                       -----------------------------------
   97 00000030         ;=== SUB ROUTINE =======================================
                       ===================================
   98 00000030         ;-------------------------------------------------------
                       -----------------------------------
   99 00000030         ;-------------------------------------------------------
                       ----------------------------------
  100 00000030         ; Configurazione del pin dove è collegato il led rosso c
                       ome output digitale
  101 00000030         ;  INPUT:  none
  102 00000030         ;  OUTPUT: none
  103 00000030         ;  AUTORE: Filippo Bilardo
  104 00000030         ;  29/03/19  1.0  Versione iniziale
  105 00000030         ;-------------------------------------------------------
                       ----------------------------------
  106 00000030         LedRossoInit
  107 00000030 B503            PUSH{LR,         R0-R1}
  108 00000032 4819            LDR              R0,=RCC_CR_AHB2
  109 00000034 6801            LDR              R1,[R0]
  110 00000036 F041 0102       ORR              R1,#1<<PB2_PORT_AHB2_BIT
  111 0000003A 6001            STR              R1,[R0]
  112 0000003C 4817            LDR              R0,=GPIOB_MODER
  113 0000003E 6801            LDR              R1,[R0]
  114 00000040 F021 0120       BIC              R1,#1<<PB2_MODERH_BIT
  115 00000044 F041 0110       ORR              R1,#1<<PB2_MODERL_BIT
  116 00000048 6001            STR              R1,[R0]
  117 0000004A E8BD 4003       POP{LR,          R0-R1}



ARM Macro Assembler    Page 4 


  118 0000004E 4770            BX               LR
  119 00000050         
  120 00000050         ;-------------------------------------------------------
                       ----------------------------------
  121 00000050         ; LedToggle - Exor con 1 del bit corrispondente al pin d
                       ove è collegato il LED
  122 00000050         ;  INPUT:  none
  123 00000050         ;  OUTPUT: none
  124 00000050         ;  AUTORE: Filippo Bilardo
  125 00000050         ;  29/03/19  1.0  Versione iniziale
  126 00000050         ;-------------------------------------------------------
                       ----------------------------------
  127 00000050         LedRossoToggle
  128 00000050 B503            PUSH{LR,         R0-R1}
  129 00000052 4813            LDR              R0,=GPIOB_ODR
  130 00000054 6801            LDR              R1,[R0]
  131 00000056 F081 0104       EOR              R1,#1<<PB2_ODR_BIT
  132 0000005A 6001            STR              R1,[R0]
  133 0000005C E8BD 4003       POP              {LR, R0-R1}
  134 00000060 4770            BX               LR
  135 00000062         
  136 00000062         ;-------------------------------------------------------
                       ----------------------------------
  137 00000062         ; Lampeggio del led rosso presente nella scheda
  138 00000062         ;
  139 00000062         ;  INPUT:  R0 numero di lampeggi; R1 ritardo in ms
  140 00000062         ;  OUTPUT: none
  141 00000062         ;  AUTORE: 
  142 00000062         ;  01/01/01  1.0  Versione iniziale
  143 00000062         ;-------------------------------------------------------
                       ----------------------------------
  144 00000062         LedRossoBlink
  145 00000062 4770            BX               LR
  146 00000064         
  147 00000064         ;-------------------------------------------------------
                       ----------------------------------
  148 00000064         ; 10 lampeggi dei led rosso e verde ad intervalli di 100
                       ms;
  149 00000064         ;  INPUT:  none
  150 00000064         ;  OUTPUT: none
  151 00000064         ;  AUTORE: 
  152 00000064         ;  01/01/01  1.0  Versione iniziale
  153 00000064         ;-------------------------------------------------------
                       ----------------------------------
  154 00000064         LedTest
  155 00000064 4770            BX               LR
  156 00000066         
  157 00000066         ;-------------------------------------------------------
                       ----------------------------------
  158 00000066         ;-------------------------------------------------------
                       ----------------------------------
  159 00000066         ;-------------------------------------------------------
                       ----------------------------------
  160 00000066         ;-------------------------------------------------------
                       ----------------------------------
  161 00000066         ;LedVerdeInit
  162 00000066 480C            LDR              R0,=RCC_CR_AHB2
  163 00000068 6801            LDR              R1,[R0]
  164 0000006A F041 0110       ORR              R1,#1<<PE8_PORT_AHB2_BIT



ARM Macro Assembler    Page 5 


  165 0000006E 6001            STR              R1,[R0]
  166 00000070         
  167 00000070 480C            LDR              R0,=GPIOE_MODER
  168 00000072 6801            LDR              R1,[R0]
  169 00000074 F421 3100       BIC              R1,#1<<PE8_MODERH_BIT
  170 00000078 F441 3180       ORR              R1,#1<<PE8_MODERL_BIT
  171 0000007C 6001            STR              R1,[R0]
  172 0000007E BC03            POP{R0,          R1}
  173 00000080 4770            BX               LR
  174 00000082         
  175 00000082         
  176 00000082         ;LedRossoToggle
  177 00000082 4807            LDR              R0,=GPIOB_ODR
  178 00000084 6801            LDR              R1,[R0]
  179 00000086 F081 0104       EOR              R1,#1<<PB2_ODR_BIT
  180 0000008A 6001            STR              R1,[R0]
  181 0000008C         
  182 0000008C         ;LedVerdeToggle
  183 0000008C 4806            LDR              R0,=GPIOE_ODR
  184 0000008E 6801            LDR              R1,[R0]
  185 00000090 F481 7180       EOR              R1,#1<<PE8_ODR_BIT
  186 00000094 6001            STR              R1,[R0]
  187 00000096         
  188 00000096         ;-------------------------------------------------------
                       -----------------------------------
  189 00000096 00 00           ALIGN
  190 00000098                 END
              4002104C 
              48000400 
              48000414 
              48001000 
              48001014 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M4.fp.sp --depen
d=.\objects\main.d -o.\objects\main.o -IC:\Keil_v5\ARM\PACK\Keil\STM32L4xx_DFP\
2.6.1\Drivers\CMSIS\Device\ST\STM32L4xx\Include --predefine="__EVAL SETA 1" --p
redefine="__MICROLIB SETA 1" --predefine="__UVISION_VERSION SETA 536" --predefi
ne="STM32L476xx SETA 1" --list=.\listings\main.lst main.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

DelayMs 00000012

Symbol: DelayMs
   Definitions
      At line 81 in file main.s
   Uses
      At line 64 in file main.s
Comment: DelayMs used once
DelayMs_1ms 00000020

Symbol: DelayMs_1ms
   Definitions
      At line 86 in file main.s
   Uses
      At line 90 in file main.s
Comment: DelayMs_1ms used once
DelayMs_end 0000002A

Symbol: DelayMs_end
   Definitions
      At line 91 in file main.s
   Uses
      At line 88 in file main.s
Comment: DelayMs_end used once
LedRossoBlink 00000062

Symbol: LedRossoBlink
   Definitions
      At line 144 in file main.s
   Uses
      None
Comment: LedRossoBlink unused
LedRossoInit 00000030

Symbol: LedRossoInit
   Definitions
      At line 106 in file main.s
   Uses
      At line 55 in file main.s
Comment: LedRossoInit used once
LedRossoToggle 00000050

Symbol: LedRossoToggle
   Definitions
      At line 127 in file main.s
   Uses
      At line 65 in file main.s
Comment: LedRossoToggle used once
LedTest 00000064

Symbol: LedTest
   Definitions
      At line 154 in file main.s
   Uses
      None
Comment: LedTest unused
MainLoop 00000004

Symbol: MainLoop



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

   Definitions
      At line 62 in file main.s
   Uses
      At line 66 in file main.s
Comment: MainLoop used once
MyCode 00000000

Symbol: MyCode
   Definitions
      At line 42 in file main.s
   Uses
      None
Comment: MyCode unused
__main 00000000

Symbol: __main
   Definitions
      At line 53 in file main.s
   Uses
      At line 47 in file main.s
Comment: __main used once
10 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

GPIOB_MODER 48000400

Symbol: GPIOB_MODER
   Definitions
      At line 23 in file main.s
   Uses
      At line 112 in file main.s
Comment: GPIOB_MODER used once
GPIOB_ODR 48000414

Symbol: GPIOB_ODR
   Definitions
      At line 24 in file main.s
   Uses
      At line 129 in file main.s
      At line 177 in file main.s

GPIOE_MODER 48001000

Symbol: GPIOE_MODER
   Definitions
      At line 25 in file main.s
   Uses
      At line 167 in file main.s
Comment: GPIOE_MODER used once
GPIOE_ODR 48001014

Symbol: GPIOE_ODR
   Definitions
      At line 26 in file main.s
   Uses
      At line 183 in file main.s
Comment: GPIOE_ODR used once
PB2_MODERH_BIT 00000005

Symbol: PB2_MODERH_BIT
   Definitions
      At line 30 in file main.s
   Uses
      At line 114 in file main.s
Comment: PB2_MODERH_BIT used once
PB2_MODERL_BIT 00000004

Symbol: PB2_MODERL_BIT
   Definitions
      At line 31 in file main.s
   Uses
      At line 115 in file main.s
Comment: PB2_MODERL_BIT used once
PB2_ODR_BIT 00000002

Symbol: PB2_ODR_BIT
   Definitions
      At line 32 in file main.s
   Uses
      At line 131 in file main.s
      At line 179 in file main.s

PB2_PORT_AHB2_BIT 00000001



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols


Symbol: PB2_PORT_AHB2_BIT
   Definitions
      At line 29 in file main.s
   Uses
      At line 110 in file main.s
Comment: PB2_PORT_AHB2_BIT used once
PE8_MODERH_BIT 00000011

Symbol: PE8_MODERH_BIT
   Definitions
      At line 35 in file main.s
   Uses
      At line 169 in file main.s
Comment: PE8_MODERH_BIT used once
PE8_MODERL_BIT 00000010

Symbol: PE8_MODERL_BIT
   Definitions
      At line 36 in file main.s
   Uses
      At line 170 in file main.s
Comment: PE8_MODERL_BIT used once
PE8_ODR_BIT 00000008

Symbol: PE8_ODR_BIT
   Definitions
      At line 37 in file main.s
   Uses
      At line 185 in file main.s
Comment: PE8_ODR_BIT used once
PE8_PORT_AHB2_BIT 00000004

Symbol: PE8_PORT_AHB2_BIT
   Definitions
      At line 34 in file main.s
   Uses
      At line 164 in file main.s
Comment: PE8_PORT_AHB2_BIT used once
RCC_CR_AHB2 4002104C

Symbol: RCC_CR_AHB2
   Definitions
      At line 27 in file main.s
   Uses
      At line 108 in file main.s
      At line 162 in file main.s

13 symbols
360 symbols in table
